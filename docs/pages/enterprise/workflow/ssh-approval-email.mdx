---
title: Teleport Access Requests with Email
description: How to set up the Teleport email plugin to notify users when another user requests elevated privileges.
---

This guide will explain how to set up Teleport to send Just-in-Time Access
Request notifications to users via email. Since all organizations use email for
at least some of their communications, Teleport's email plugin makes it
straightforward to integrate Access Requests into your existing workflows. This
makes it easier to implement security best practices without compromising
productivity.

## Prerequisites

(!/docs/pages/includes/commercial/prereqs/tabs.mdx!)

This guide assumes that you have:

- Access to an SMTP service. The Teleport email plugin supports either Mailgun
  or a generic SMTP service that authenticates via username and password.

(!/docs/pages/includes/tctl.mdx!)

## Step 1/8. Define RBAC resources

Before you set up the email plugin, you will need to enable Role Access Requests
in your Teleport cluster.

(!/docs/pages/includes/plugins/editor-request-rbac.mdx!)

## Step 2/8. Install the Teleport email plugin

<ScopedBlock scope={["enterprise", "oss"]}>

We recommend installing Teleport plugins on the same host as the Teleport Proxy
Service. This is an ideal location as plugins have a low memory footprint, and
will require both public internet access and Teleport Auth Service access. 

</ScopedBlock>

<ScopedBlock scope="cloud">

Install the Teleport email plugin on a host that can access both your
Teleport Cloud tenant and your SMTP service.

</ScopedBlock>

We currently only provide Linux amd64 binaries. You can also compile the plugin
from source.

<Tabs>
<TabItem label="Download">
  ```code
  $ curl -L https://get.gravitational.com/teleport-access-email-v(=teleport.version=)-linux-amd64-bin.tar.gz
  $ tar -xzf teleport-access-email-v(=teleport.version=)-linux-amd64-bin.tar.gz
  $ cd teleport-access-email
  $ ./install
  ```
</TabItem>
<TabItem label="From Source">

  To install from source you need `git` and `go` installed. If you do not have
  Go installed, visit the Go [downloads page](https://go.dev/dl/).

  ```code
  # Checkout teleport-plugins
  $ git clone https://github.com/gravitational/teleport-plugins.git
  $ cd teleport-plugins/access/email
  $ make
  ```

  Move the `teleport-email` binary into a directory in your `PATH`.

</TabItem>
</Tabs>

{/* TODO: Add a command to execute the binary and make sure it's been installed
correctly */}

## Step 3/8. Create a user and role for the plugin

(!docs/pages/includes/plugins/rbac.mdx!)

## Step 4/8. Export the access plugin identity

(!docs/pages/includes/plugins/identity-export.mdx!)

## Step 5/8. Configure the plugin

At this point, you have generated credentials that the email plugin will use to
connect to Teleport. You will now configure the plugin to use these credentials
to receive Access Request notifications from Teleport and email them to your
chosen recipients.

The Teleport email plugin uses a config file in TOML format. Generate a
boilerplate config by running the following command:

```code
$ teleport-email configure | sudo tee /etc/teleport-email.toml
```

Then, edit the config as needed.

#### `[teleport]`

The final configuration will resemble the following:


<Tabs>
<TabItem label="Teleport Enterprise" scope={["oss", "enterprise"]}>

**`addr`**: Include the hostname and HTTPS port of your Teleport Proxy Service
(e.g., `mytenant.teleport.sh:443`). If you are configuring your plugin to
connect directly to the Teleport Auth Service, use your Auth Service's gRPC
endpoint (e.g., `teleport.example.com:3025`).

**`identity`**, **`client_key`**, **`client_crt`**, **`root_cas`**: The values
you will use for these fields depend on whether the Mattermost plugin will
connect to the Proxy Service or the Auth Service. 

If you exported an identity file earlier, fill in the `identity` field with the
path to the file and comment out the other fields.

If you exported a client key, client certificate, and root CAs earlier, fill in
the `client_key`, `client_crt`, and `root_cas` fields with the paths to these
files and leave `identity` commented out.

</TabItem>
<TabItem label="Teleport Cloud" scope="cloud">

**`addr`**: Include the hostname and HTTPS port of your Teleport Cloud tenant
(e.g., `mytenant.teleport.sh:443`).

**`identity`**, **`client_key`**, **`client_crt`**, **`root_cas`**: Fill in the
`identity` field with the path to the identity file you exported earlier and
comment out the other fields.

</TabItem>
</Tabs>

#### `[mailgun]` or `[smtp]`

Provide the credentials for your SMTP service depending on whether you are using
Mailgun or another solution.

<Tabs>
<TabItem label="Mailgun">

In the `mailgun` section, assign `domain` to the domain name and subdomain of
your Mailgun account. Assign `private_key` to your Mailgun private key.

</TabItem>
<TabItem label="Generic SMTP Service">

Assign `host` to the fully qualified domain name of your SMTP service, omitting
the URL scheme and port. Assign `port` to the port of your SMTP service, then
fill in `username` and `password`. 

{/* TODO: What to do for password_file? Always use this instead of password? */}

</TabItem>
</Tabs>

#### `[users]`

{/* TODO: Look at how to fill this in */}

{/* TODO: Add an example tailored to the RBAC resources we created at the start
of the guide */}

```conf
# /etc/teleport-email.toml
[teleport]
addr = "example.com:3025"                               # Teleport Auth/Proxy/Tunnel Server Address

# Identity file exported with tctl auth sign --format file
identity = "/var/lib/teleport/plugins/email/auth_id"    # Identity file

[mailgun]
domain = "sandboxbd81caddef744a69be0e5b544ab0c3bd.mailgun.org" # Mailgun domain name
private_key = "xoxb-11xx"                                      # Mailgun private key

# As an alternative, you can use SMTP server credentials:
#
# [smtp]
# host = "smtp.gmail.com"
# port = 587
# username = "username@gmail.com"
# password = ""
# password_file = "/var/lib/teleport/plugins/email/smtp_password"

[users]
sender = "noreply@example.com"   # From: email address
recipients = ["all@example.com"] # These recipients will receive all review requests

[log]
output = "stderr" # Logger output. Could be "stdout", "stderr" or "/var/lib/teleport/email.log"
severity = "INFO" # Logger severity. Could be "INFO", "ERROR", "DEBUG" or "WARN".
```

## Step 7/8. Test the email plugin

Assuming that Teleport is running, the email credentials are correct, the plugin
config, and provided all the certificates — you can now run the plugin and test
the notifications.

```code
$ teleport-email start
```

If everything works as expected, the log output should look like this:

```code
$ teleport-email start
INFO   Starting Teleport Access Email Plugin (): email/app.go:80
INFO   Plugin is ready email/app.go:101
```

### Create an Access Request

(!docs/pages/includes/plugins/create-request.mdx!)

The recipients you configured earlier should receive notifications of the
request by email. 

### Resolve the request

(!docs/pages/includes/plugins/resolve-request.mdx!)

## Step 8/8. Set up systemd

In production, we recommend starting the Teleport plugin daemon via an init
system like systemd. Here's the recommended Teleport plugin service unit file
for systemd:

```ini
(!examples/systemd/plugins/teleport-email.service!)
```

Save this as `teleport-email.service` in either `/usr/lib/systemd/system/` or
another [unit file load
path](https://www.freedesktop.org/software/systemd/man/systemd.unit.html#Unit%20File%20Load%20Path)
supported by systemd.

Enable and start the plugin:

```code
$ sudo systemctl enable teleport-email
$ sudo systemctl start teleport-email
```

## Feedback

If you have any issues with this plugin please create an [issue
on GitHub](https://github.com/gravitational/teleport-plugins/issues/new).
